<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
  
    <title>CAPSUL &#8212; CAPSUL - Chain algorithm in pipelines and execute in many contexts</title>
  <!-- htmltitle is before nature.css - we use this hack to load bootstrap first -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../_static/css/bootstrap.min.css" media="screen" />
  <link rel="stylesheet" href="../_static/css/bootstrap-responsive.css"/>
  <link rel="icon" href="../_static/capsul_logo.svg"/>

    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="search" title="Search" href="../search.html" />
  
   
       <script type="text/javascript" src="../_static/sidebar.js"></script>
   
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="../_static/js/bootstrap.min.js" type="text/javascript"></script>

  <script type="text/javascript">
    $("div.buttonNext, div.buttonPrevious").hover(
       function () {
           $(this).css('background-color', '#FF9C34');
       },
       function () {
           $(this).css('background-color', '#A7D6E2');
       }
    );
    var bodywrapper = $('.bodywrapper');
    var sidebarbutton = $('#sidebarbutton');
    sidebarbutton.css({'height': '900px'});
  </script>

  </head>
  <body role="document">

  <div class="header" style="display: inline; width: 80%; margin-left:10%;">
    <a href="../index.html">
    <img src="../_static/capsul_logo.svg" alt="Capsul logo" style="display: inline; height:4em;"/>
    </a >
    <div class="navbar" style="display: inline;">
      <ul>
        <li><a href="../index.html">Home</a></li>
        <li><a href="../installation.html">Installation</a></li>
        <li class="btn-li">
          <div class="btn-group">
            <a href="../documentation.html">Documentation</a>
            <a class="btn dropdown-toggle" data-toggle="dropdown">
              <span class="caret"></span>
            </a>
            <ul class="dropdown-menu">
              <li class="link-title">CAPSUL</li>
              <li><a href="#">User guide</a></li>
              <li><a href="../api_tree/index.html">API</a></li>
              <li><a href="../gui_tree/index.html">GUI</a></li>
              <li class="divider"></li>
              <li><a href="../developer_tree/index.html">Development</a></li>
            </ul>
          </div>
        </li>
        <li>
          <!-- form action="search.html" method="get" style="display: inline-block;"></form>
            <input type="text" class="search-header" name="q" placeholder="search documentation..." value=""></input>
            <button type="submit" >search</button>
          </form -->
          <form class="search_box" method="get" action="http://www.google.com/search" style="display: inline-block;">
            <input class="search-header" type="text" name="q" placeholder="search documentation..." />
            <input class="submit" type="image" src="../_static/find_read.png" value="Search" />
            <input type="hidden" name="sitesearch" value="brainvisa.info/capsul" />
          </form>
        </li>
      </ul>
    </div> <!-- end navbar -->
  </div>


<div class="content-wrapper">
    <div class="sphinxsidebar">
      <div class="sphinxsidebarwrapper">

        <!-- info setup -->
          <p class="doc-version">
           This documentation is for CAPSUL <strong>version 2.1.0</strong>
          </p>
<!--        <p class="citing">
          If you use the software, please do not esitate to 
          <a &mdash; <a href="https://bioproj.extra.cea.fr/redmine/projects/capsul/">
          Report a Bug</a>.
        </p>-->

      <!-- toc tree -->
      <ul>
<li><a class="reference internal" href="#">User Guide</a><ul>
<li><a class="reference internal" href="#tutorial">Tutorial</a></li>
<li><a class="reference internal" href="#building-processes">Building processes</a></li>
<li><a class="reference internal" href="#building-pipelines">Building pipelines</a><ul>
<li><a class="reference internal" href="#python-api">Python API</a></li>
<li><a class="reference internal" href="#xml-files">XML files</a></li>
<li><a class="reference internal" href="#graphical-display-and-edition">Graphical display and edition</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuration">Configuration</a><ul>
<li><a class="reference internal" href="#studyconfig-object-options-modules">StudyConfig object, options, modules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running">Running</a><ul>
<li><a class="reference internal" href="#running-as-commandline">Running as commandline</a></li>
<li><a class="reference internal" href="#simple-sequential-execution">Simple, sequential execution</a></li>
<li><a class="reference internal" href="#distributed-execution">Distributed execution</a><ul>
<li><a class="reference internal" href="#running-on-the-fly-using-studyconfig">Running on-the-fly using StudyConfig</a></li>
<li><a class="reference internal" href="#generating-and-saving-workflows">Generating and saving workflows</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#parameters-completion">Parameters completion</a><ul>
<li><a class="reference internal" href="#completion-model">Completion model</a><ul>
<li><a class="reference internal" href="#using-completion">Using completion</a></li>
<li><a class="reference internal" href="#graphical-interface">Graphical interface</a></li>
<li><a class="reference internal" href="#defining-a-custom-completion-system">Defining a custom completion system</a><ul>
<li><a class="reference internal" href="#path-building-from-attributes">Path building from attributes</a></li>
<li><a class="reference internal" href="#declaring-attributes-sets">Declaring attributes sets</a></li>
<li><a class="reference internal" href="#declaring-process-and-parameters-attributes">Declaring process and parameters attributes</a></li>
<li><a class="reference internal" href="#putting-things-together">Putting things together</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#file-organization-model-fom">File Organization Model (FOM)</a><ul>
<li><a class="reference internal" href="#using-foms">Using FOMs</a></li>
<li><a class="reference internal" href="#defining-foms">Defining FOMs</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#iterating-processing-over-multiple-data">Iterating processing over multiple data</a></li>
</ul>
</li>
</ul>


      </div>
    </div>
  

  <div class="content">
      
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="user-guide">
<span id="capsul-guide"></span><h1>User Guide<a class="headerlink" href="#user-guide" title="Permalink to this headline">¶</a></h1>
<p>The main documentation of all the proposed scripts.</p>
<div class="section" id="tutorial">
<h2>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h2>
<p>Different tutorials are available as <a class="reference external" href="http://ipython.org/notebook.html">IPython notebooks</a>.</p>
<p>Capsul may be used in two ways:</p>
<ul class="simple">
<li>a descriptive interface allows to develop processing bricks using simple Python functions and pipelines using a XML text description.<ul>
<li><a class="reference external" href="../_static/tutorial/capsul_descriptive_tutorial.ipynb">Download notebook</a></li>
<li><a class="reference external" href="../_static/tutorial/capsul_descriptive_tutorial.html">See the notebook contents</a></li>
</ul>
</li>
<li>an object-oriented interface that uses Python classes programming. Note that this interface is compatible with the descriptive one, and allows more functionalities and tweak possibilities.<ul>
<li><a class="reference external" href="../_static/tutorial/capsul_object_oriented_tutorial.ipynb">Download notebook</a></li>
<li><a class="reference external" href="../_static/tutorial/capsul_object_oriented_tutorial.html">See the notebook contents</a></li>
</ul>
</li>
</ul>
<p>To run it, the following must be done:</p>
<ul>
<li><p class="first"><a class="reference internal" href="../installation.html#install-guid"><span class="std std-ref">CAPSUL installation</span></a>.</p>
</li>
<li><p class="first">have IPython installed.</p>
</li>
<li><p class="first">run the tutorial ipython notebook server, with Qt GUI support:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>ipython notebook --gui<span class="o">=</span>qt my_tutorial.ipynb
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="building-processes">
<h2>Building processes<a class="headerlink" href="#building-processes" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="building-pipelines">
<h2>Building pipelines<a class="headerlink" href="#building-pipelines" title="Permalink to this headline">¶</a></h2>
<div class="section" id="python-api">
<h3>Python API<a class="headerlink" href="#python-api" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="xml-files">
<h3>XML files<a class="headerlink" href="#xml-files" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="graphical-display-and-edition">
<h3>Graphical display and edition<a class="headerlink" href="#graphical-display-and-edition" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="studyconfig-object-options-modules">
<h3>StudyConfig object, options, modules<a class="headerlink" href="#studyconfig-object-options-modules" title="Permalink to this headline">¶</a></h3>
<p>Data paths</p>
<p>Execution options: Soma-Workflow</p>
</div>
</div>
<div class="section" id="running">
<h2>Running<a class="headerlink" href="#running" title="Permalink to this headline">¶</a></h2>
<div class="section" id="running-as-commandline">
<h3>Running as commandline<a class="headerlink" href="#running-as-commandline" title="Permalink to this headline">¶</a></h3>
<p>CAPSUL has a commandline program to run any process, pipeline, or process iteration. It can be used from a shell, or a script. It allows to run locally, either sequentially or in parallel, or on a remote processing server using Soma-Workflow.</p>
<p>The program is a python module/script:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>python -m capsul &lt;parameters&gt;
</pre></div>
</div>
<p>It can accept a variety of options to controll configuration settings, processing modes, iterations, and process parameters either through file names or via attributes and paramters completion system.</p>
<p>To get help, you may run it with the <code class="docutils literal"><span class="pre">-h</span></code> or <code class="docutils literal"><span class="pre">--help</span></code> option:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>python -m capsul -h
</pre></div>
</div>
<p><strong>Ex:</strong></p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>python -m capsul --swf -i /home/data/study_data --studyconfig /home/data/study_data/study_config.json -a <span class="nv">subject</span><span class="o">=</span>subjet01 -a <span class="nv">center</span><span class="o">=</span>subjects morphologist.capsul.morphologist.Morphologist
</pre></div>
</div>
<p>will run the Morphologist pipeline on data located in the directory <code class="docutils literal"><span class="pre">/home/data/study_data</span></code> using Soma-Workflow on the local computer, for subject <code class="docutils literal"><span class="pre">subject01</span></code></p>
<p><strong>Ex with iteration:</strong></p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>python -m capsul --swf -i /home/data/study_data --studyconfig /home/data/study_data/study_config.json -a <span class="nv">subject</span><span class="o">=</span><span class="s1">&#39;[&quot;subjet01&quot;, &quot;subject02&quot;, &quot;subject03&quot;]&#39;</span> -a <span class="nv">center</span><span class="o">=</span>subjects -I t1mri morphologist.capsul.morphologist.Morphologist
</pre></div>
</div>
<p>will iterate the same process 3 times, for 3 different subjects.</p>
<p>To work correctly, StudyConfig settings have to be correctly defined in <code class="docutils literal"><span class="pre">study_config.json</span></code> including FOM completion parameters, external software, formats, etc.</p>
<p>Alternatively, or in addition to attributes, it is possible to pass process parameters as additional options after the process name. They can be passed either as positional arguments (given in the order the process expects), or as &#8220;keyword&#8221; arguments:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>python -m capsul --swf -i /home/data/study_data --studyconfig /home/data/study_data/study_config.json -a <span class="nv">subject</span><span class="o">=</span>subjet01 -a <span class="nv">center</span><span class="o">=</span>subjects morphologist.capsul.morphologist.Morphologist /home/data/raw_data/subject01.nii.gz <span class="nv">pipeline_steps</span><span class="o">=</span><span class="s1">&#39;{&quot;importation&quot;: True, &quot;orientation&quot;: True}&#39;</span>
</pre></div>
</div>
<p>To get help about a process, its parameters, and available attributes to control its completion:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>python -m capsul --process-help morphologist.capsul.morphologist.Morphologist
</pre></div>
</div>
</div>
<div class="section" id="simple-sequential-execution">
<h3>Simple, sequential execution<a class="headerlink" href="#simple-sequential-execution" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="distributed-execution">
<h3>Distributed execution<a class="headerlink" href="#distributed-execution" title="Permalink to this headline">¶</a></h3>
<div class="section" id="running-on-the-fly-using-studyconfig">
<h4>Running on-the-fly using StudyConfig<a class="headerlink" href="#running-on-the-fly-using-studyconfig" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="generating-and-saving-workflows">
<h4>Generating and saving workflows<a class="headerlink" href="#generating-and-saving-workflows" title="Permalink to this headline">¶</a></h4>
</div>
</div>
</div>
<div class="section" id="parameters-completion">
<h2>Parameters completion<a class="headerlink" href="#parameters-completion" title="Permalink to this headline">¶</a></h2>
<div class="section" id="completion-model">
<h3>Completion model<a class="headerlink" href="#completion-model" title="Permalink to this headline">¶</a></h3>
<div class="section" id="using-completion">
<h4>Using completion<a class="headerlink" href="#using-completion" title="Permalink to this headline">¶</a></h4>
<p>Process parameters completion for filenames is working using attributes assigned to a process or to its parameters. For instance a given data organization may organize data by study, center, subject, ... These study, center, subject elements can be seen as attributes.</p>
<p>Using an existing completion model is a matter of configuration in StudyConfig. One must use the AttributesModule of StudyConfig, then specify which organization schemas to use.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">capsul.api</span> <span class="k">import</span> <span class="n">StudyConfig</span>

<span class="n">study_config</span> <span class="o">=</span> <span class="n">StudyConfig</span><span class="p">(</span><span class="s1">&#39;test_study&#39;</span><span class="p">,</span> <span class="n">modules</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;AttributesConfig&#39;</span><span class="p">])</span>
<span class="n">study_config</span><span class="o">.</span><span class="n">input_directory</span> <span class="o">=</span> <span class="s1">&#39;/tmp/in&#39;</span>
<span class="n">study_config</span><span class="o">.</span><span class="n">output_directory</span> <span class="o">=</span> <span class="s1">&#39;/tmp/out&#39;</span>
<span class="n">study_config</span><span class="o">.</span><span class="n">attributes_schema_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="s1">&#39;capsul.attributes.test.test_attributed_process&#39;</span><span class="p">)</span>
<span class="n">study_config</span><span class="o">.</span><span class="n">attributes_schemas</span><span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;custom_ex&#39;</span>
<span class="n">study_config</span><span class="o">.</span><span class="n">attributes_schemas</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;custom_ex&#39;</span>
<span class="n">study_config</span><span class="o">.</span><span class="n">path_completion</span> <span class="o">=</span> <span class="s1">&#39;custom_ex&#39;</span>
</pre></div>
</div>
<p>In this example, the example schemas are defined in the test example <code class="docutils literal"><span class="pre">test_attributed_process</span></code>. Completion involves several modular elements:</p>
<ul class="simple">
<li>data directories: <code class="docutils literal"><span class="pre">study_config.input_directory</span></code>, <code class="docutils literal"><span class="pre">study_config.output_directory</span></code>, <code class="docutils literal"><span class="pre">study_config.shared_directory</span></code></li>
<li>schema elements module paths: these are a list of python modules, and must be specified in <code class="docutils literal"><span class="pre">study_config.attributes_schema_paths</span></code></li>
<li>Naming the attributes schemas to use for the different data directories (input, output, shared): <code class="docutils literal"><span class="pre">study_config.attributes_schemas['input']</span> <span class="pre">=</span> <span class="pre">'custom_ex'</span></code> etc. Each defines the set of attributes used in the data files organization.</li>
<li>Naming the path completion system: <code class="docutils literal"><span class="pre">study_config.path_completion</span> <span class="pre">=</span> <span class="pre">'custom_ex'</span></code>. It is responsible for building file names from the attributes set.</li>
</ul>
<p>Once configured, using completion on a process works as in this example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">process</span> <span class="o">=</span> <span class="n">study_config</span><span class="o">.</span><span class="n">get_process_instance</span><span class="p">(</span>
    <span class="s1">&#39;capsul.attributes.test.test_attributed_process.DummyProcess&#39;</span><span class="p">)</span>
<span class="n">compl_engine</span> <span class="o">=</span> <span class="n">ProcessCompletionEngine</span><span class="o">.</span><span class="n">get_completion_engine</span><span class="p">(</span><span class="n">process</span><span class="p">)</span>
<span class="n">attributes</span> <span class="o">=</span> <span class="n">compl_engine</span><span class="o">.</span><span class="n">get_attribute_values</span><span class="p">()</span>
<span class="n">attributes</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="s1">&#39;jojo&#39;</span>
<span class="n">attributes</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;barbapapa&#39;</span>
<span class="n">compl_engine</span><span class="o">.</span><span class="n">complete_parameters</span><span class="p">()</span>
</pre></div>
</div>
<p>After the call to <code class="docutils literal"><span class="pre">compl_engine.complete_parameters()</span></code>, the file parameters of <code class="docutils literal"><span class="pre">process</span></code> should be built.</p>
<p>It is possible to make completion run automatically when attributes change, using a notification callback:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">attributes</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span><span class="n">compl_engine</span><span class="o">.</span><span class="n">attributes_changed</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">attributes</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;casimir&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">process</span><span class="o">.</span><span class="n">truc</span>
<span class="go">&#39;/tmp/in/DummyProcess_truc_jojo_casimir&#39;</span>
</pre></div>
</div>
<p>Note that completion will also take place inside iterations in an iterative process, when generating a workflow.</p>
</div>
<div class="section" id="graphical-interface">
<h4>Graphical interface<a class="headerlink" href="#graphical-interface" title="Permalink to this headline">¶</a></h4>
<p>Once PyQt4 or PySide QApplication is created:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">capsul.qt_gui.widgets.attributed_process_widget</span> \
    <span class="kn">import</span> <span class="nn">AttributedProcessWidget</span>

<span class="n">cwid</span> <span class="o">=</span> <span class="n">AttributedProcessWidget</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="n">enable_attr_from_filename</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">enable_load_buttons</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">cwid</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="defining-a-custom-completion-system">
<h4>Defining a custom completion system<a class="headerlink" href="#defining-a-custom-completion-system" title="Permalink to this headline">¶</a></h4>
<p>It may require to define a few classes to handle the different aspects.</p>
<div class="section" id="path-building-from-attributes">
<h5>Path building from attributes<a class="headerlink" href="#path-building-from-attributes" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyPathCompletion</span><span class="p">(</span><span class="n">PathCompletionEngineFactory</span><span class="p">,</span> <span class="n">PathCompletionEngine</span><span class="p">):</span>
    <span class="n">factory_id</span> <span class="o">=</span> <span class="s1">&#39;custom_ex&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MyPathCompletion</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_path_completion_engine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">attributes_to_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>
        <span class="n">study_config</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">get_study_config</span><span class="p">()</span>
        <span class="n">att_dict</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">.</span><span class="n">get_parameters_attributes</span><span class="p">()[</span><span class="n">parameter</span><span class="p">]</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">process</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">parameter</span><span class="p">]</span>
        <span class="c1"># get attributes sorted by user_traits</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">user_traits</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">att_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">and</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Undefined</span><span class="p">:</span>
                <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
        <span class="k">if</span> <span class="s1">&#39;generated_by_parameter&#39;</span> <span class="ow">in</span> <span class="n">att_dict</span><span class="p">:</span>
            <span class="n">directory</span> <span class="o">=</span> <span class="n">study_config</span><span class="o">.</span><span class="n">output_directory</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">directory</span> <span class="o">=</span> <span class="n">study_config</span><span class="o">.</span><span class="n">input_directory</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">elements</span><span class="p">))</span>
</pre></div>
</div>
<p>Note the <code class="docutils literal"><span class="pre">factory_id</span></code> class variable: it is used to register the classes in a factory managed in the study config AttributesConfig module. Its value may be named in the <code class="docutils literal"><span class="pre">study_config.attributes_schemas</span></code> dictionary, as a value for a given directory organization.</p>
</div>
<div class="section" id="declaring-attributes-sets">
<h5>Declaring attributes sets<a class="headerlink" href="#declaring-attributes-sets" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CustomAttributesSchema</span><span class="p">(</span><span class="n">AttributesSchema</span><span class="p">):</span>
    <span class="n">factory_id</span> <span class="o">=</span> <span class="s1">&#39;custom_ex&#39;</span>

    <span class="k">class</span> <span class="nc">Acquisition</span><span class="p">(</span><span class="n">EditableAttributes</span><span class="p">):</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>
        <span class="n">subject</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Group</span><span class="p">(</span><span class="n">EditableAttributes</span><span class="p">):</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Processing</span><span class="p">(</span><span class="n">EditableAttributes</span><span class="p">):</span>
        <span class="n">analysis</span> <span class="o">=</span> <span class="n">String</span><span class="p">()</span>
</pre></div>
</div>
<p>The classes Acquisition, Group and Processing will be available for association to process attributes.</p>
</div>
<div class="section" id="declaring-process-and-parameters-attributes">
<h5>Declaring process and parameters attributes<a class="headerlink" href="#declaring-process-and-parameters-attributes" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DummyProcessAttributes</span><span class="p">(</span><span class="n">ProcessAttributes</span><span class="p">):</span>
    <span class="n">factory_id</span> <span class="o">=</span> <span class="s1">&#39;DummyProcess&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process</span><span class="p">,</span> <span class="n">schema_dict</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DummyProcessAttributes</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">process</span><span class="p">,</span> <span class="n">schema_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_parameter_attributes</span><span class="p">(</span><span class="s1">&#39;truc&#39;</span><span class="p">,</span> <span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="s1">&#39;Acquisition&#39;</span><span class="p">,</span>
                                      <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;array&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_parameter_attributes</span><span class="p">(</span><span class="s1">&#39;bidule&#39;</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="s1">&#39;Acquisition&#39;</span><span class="p">,</span>
                                      <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;array&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>In this example, the parameters <code class="docutils literal"><span class="pre">truc</span></code> and <code class="docutils literal"><span class="pre">bidule</span></code> will inherit the attributes declared for <code class="docutils literal"><span class="pre">Acquisition</span></code>: namely, <code class="docutils literal"><span class="pre">center</span></code> and <code class="docutils literal"><span class="pre">subject</span></code>.</p>
</div>
<div class="section" id="putting-things-together">
<h5>Putting things together<a class="headerlink" href="#putting-things-together" title="Permalink to this headline">¶</a></h5>
<p>The modules containing these definitions must be registered in <code class="docutils literal"><span class="pre">study_config.attributes_schema_paths</span></code>, and their names have to be used in <code class="docutils literal"><span class="pre">study_config.attributes_schemas</span></code> and <code class="docutils literal"><span class="pre">study_config.path_completion</span></code></p>
</div>
</div>
</div>
<div class="section" id="file-organization-model-fom">
<h3>File Organization Model (FOM)<a class="headerlink" href="#file-organization-model-fom" title="Permalink to this headline">¶</a></h3>
<div class="section" id="using-foms">
<h4>Using FOMs<a class="headerlink" href="#using-foms" title="Permalink to this headline">¶</a></h4>
<p>FOMs are integrated in the completion system. It is activated using the FomConfig module of StudyConfig:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">capsul.api</span> <span class="k">import</span> <span class="n">StudyConfig</span>

<span class="n">study_config</span> <span class="o">=</span> <span class="n">StudyConfig</span><span class="p">(</span><span class="s1">&#39;test_study&#39;</span><span class="p">,</span> <span class="n">modules</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;FomConfig&#39;</span><span class="p">])</span>
<span class="n">study_config</span><span class="o">.</span><span class="n">inpupt_fom</span> <span class="o">=</span> <span class="s1">&#39;morphologist-auto-1.0&#39;</span>
<span class="n">study_config</span><span class="o">.</span><span class="n">output_fom</span> <span class="o">=</span> <span class="s1">&#39;morphologist-auto-1.0&#39;</span>
</pre></div>
</div>
<p>The FOM module (throught the AttributesConfig module) sets up the attributes schema:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">study_config</span><span class="o">.</span><span class="n">attributes_schema_paths</span>
<span class="go">[&#39;capsul.attributes.completion_engine_factory&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">study_config</span><span class="o">.</span><span class="n">process_completion</span>
<span class="go">&#39;builtin&#39;</span>
</pre></div>
</div>
<p>The rest works just as the above completion system.</p>
</div>
<div class="section" id="defining-foms">
<h4>Defining FOMs<a class="headerlink" href="#defining-foms" title="Permalink to this headline">¶</a></h4>
</div>
</div>
</div>
<div class="section" id="iterating-processing-over-multiple-data">
<h2>Iterating processing over multiple data<a class="headerlink" href="#iterating-processing-over-multiple-data" title="Permalink to this headline">¶</a></h2>
</div>
</div>


          </div>
        </div>
      </div>
    <div class="clearer">
    </div>
  </div>
  
</div>

<div class="footer">
    &copy; 2017, BrainVISA team &lt;support@brainvisa.info&gt;.
</div>
  </body>
</html>