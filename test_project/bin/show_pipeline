#! /usr/bin/env python
from __future__ import print_function

import os.path as osp
import sys

from soma.qt_gui.qt_backend import QtGui
import capsul
from capsul.qt_gui.widgets import PipelineDevelopperView

if len(sys.argv) != 2:
    print('Invalid arguments: usage:', sys.argv[0], '<directory>', file=sys.stderr)
    sys.exit(1)
           
base_directory = sys.argv[1]
capsul_engine_json = osp.join(base_directory, 'capsul_engine.json')
cengine = capsul.engine(capsul_engine_json)

app = QtGui.QApplication(sys.argv)
with cengine.execution_context:
    pipeline1 = cengine.execution_context.get_process_instance('test_project.DocumentsClassifierPipeline')
    view1 = PipelineDevelopperView(pipeline1, allow_open_controller=True, show_sub_pipelines=True)
    view1.show()
    pipeline = cengine.get_process_instance('test_project.DocumentsClassifierPipeline')
    view = PipelineDevelopperView(pipeline, allow_open_controller=True, show_sub_pipelines=True)
    view.show()
    for n, t in pipeline.nodes['WordsClassifier'].process.user_traits().iteritems():
        print(n, t.hidden)
app.exec_()
